<html>
	<head>


   <meta charset="UTF-8">

   		<style>
			#quiz
			 {  		
			position: fixed;
			top:10px;
			left:20px;
			z-index:20;
			width:100%;
			height:100%;
            color:white;

			 }

		</style>




        <script type="text/javascript" src="js2/jquery-3.1.0.min.js"></script> 
        
<!--        
        <!-- That's the way to refer Jquery, put it to the  src in the <script>. And copy the Jquery file to the same folder as this html. 
        So then we dont need to use the full address of this Jquery ie:D:\GitLibrary\AR UI HTML\jquery-3.1.0.min.js. Just refer to the name of this Jquery is OK now-->
        <script type="text/javascript">

            // 如果使用 var content = 100; 这样就直接可以赋值。
            // 但是如果是 var content = document.get.....就需要放在某个function内，然后这个function还必须被call。这个content赋值才能运行。

            // Put the whole Jquery code under this document.ready function.
           

           //For processing the data response from server.
           //var resDataJson={} ; //Define the variable as a object ,for storing the responseData from the server

        //    function changeDOM(text){
        //        $("#p1").text("The movie titles are "+text);
        //    };


            $(document).ready(function(){ // make a click event, and put ajax under this click function.

                $("#button").bind("click touchstart",function(){  //bind("click touchstart" function) is for Ipad touch, because there maybe no click event in Ipad. 

                     var name = $("#Name").val(); // 这个拿value的function需要被call出来的。所以放在了click的方法下。
                                                    // 拿form的值 用 .val() 
                    var iD = $("#ID").val();
                    var material = $("#Material").val();
                    var load = $("#Load").val();
                    var design = $("#Design").val();
                
                $.ajax({
                    type:"POST",
                    url:"http://192.168.1.101:3030", //这次测试只在自己的html,js之间发送。 即只需要 /whatever 即可。  //127.0.0.1 is directing to localhost , so it is direct to server on our own computer.
                    async:true,
                    dataType:"text", //Make the dataType to text. The "string" is not a ajax dataType, instead, "text" represent the string type.           // So we need 192,168.1.101 which is the ip in my computer, so other device can visit.                                               
                    data:JSON.stringify({"Name":name, "ID":iD, "Material":material , "Load":load , "Design":design }), //Transfer JSON format to string. We are transferring data, so it is better to make JSON data to string. 
                    success:function(){ //这是一个回调函数。success后执行什么。 responseData 为server返回的数据。 把需要做的放在这个sucess回调函数中。比如改变DOM.....
                        alert("Json data sent successfully!");
                        //console.log("The response data is "+responseData+"The data type is "+typeof responseData);
                        //resDataJson = JSON.parse(responseData);//Parse the responseData(str) to Json obj, and store it in resDataJson variable
                        //console.log(resDataJson.Name);
                        

                    },
                    error:function(jqXHR, textStatus, errorThrown){ //这是一个回调函数。error后执行什么。errorThrown include the actual error message. jqXHR includes the reponse information from server. 用于调试。
                        alert("There are some errors");
                        alert("The response data is"+jqXHR.responseText+"The type of response data is "+typeof jqXHR.responseText );
                        alert("The error is"+errorThrown);
                    }

                    //function(){....} 是匿名函数，不需要函数名，直接执行。 可以放置参数，也可以不放置。 
               
                });         


            });
                         

            });




            </script>      








		<title>EDU AR/QRCODE SYSTEM</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>

        <!-- This is a older version of threejs which have the function of loader.setCrossOrigin = true -->
		<script src="js2/three.min.js"></script>  

<!-- reference 
		<script src="js/loaders/DDSLoader.js"></script>
		<script src="js/loaders/MTLLoader.js"></script>

		<script type="text/javascript" src="./js2/dat.gui.js"></script>
		<script type="text/javascript" src="./js2/dat.gui.min.js"></script>
		<script src="js2/stats.min.js" ></script>

		<script src="./js/loaders/OBJLoader.js"></script>
-->


<!-- New reference -->



		<script src="js2/MTLLoader.js"></script>
		<script src="js2/OBJLoader.js"></script>

		<script src="js2/OBJMTLLoader.js"></script>



<!-- New reference -->





		<!--

		<script src="js/MorphAnimMesh.js"></script>
        <script src="js/loaders/collada/Animation.js"></script>
        <script src="js/loaders/collada/AnimationHandler.js"></script>
        <script src="js/loaders/collada/KeyFrameAnimation.js"></script>
        <script src="js/loaders/sea3d/SEA3D.js"></script>
        <script src="js/loaders/sea3d/SEA3DLZMA.js"></script>
        <script src="js/loaders/sea3d/SEA3DLoader.js"></script>

		-->


		<script>
            var hybridObj;
			var isProjectionMatrixSet = false;
			//var clock = new THREE.Clock();
			var threejsContainerObj;
			var cubeContainer;
			var objLoaderContainer;
			var objMtlContainer;
			var stats;
			var rendererWidth = screen.height;
            var rendererHeight = screen.width;
            var aspectRatio = rendererWidth / rendererHeight;

			//Define camera 
			var camera = new THREE.PerspectiveCamera( 70, aspectRatio, 1, 1000 );
			var scene = new THREE.Scene();
			camera.position.z = 30;


            //定义parent container. 每个具体的模型物体都要有一个container， 然后再把所有container添加到父container中。
			// create a parent 3D object to contain all the three js objects
            // we can apply the marker transform to this object and all of its
            // children objects will be affected
			threejsContainerObj = new THREE.Object3D();
			cubeContainer = new THREE.Object3D();
			objLoaderContainer = new THREE.Object3D();
			objMtlContainer = new THREE.Object3D();

			duplexArcContainer = new THREE.Object3D();
			duplexElecContainer = new THREE.Object3D();

            // turning off matrixAutoUpdate lets us manually set its transformation matrix
            // to that of the Hybrid Object - instead of using rotation, scale, and position
            // (https://threejs.org/docs/index.html#Manual/Introduction/Matrix_transformations)
            threejsContainerObj.matrixAutoUpdate = false;
            scene.add(threejsContainerObj);



            //渲染器设置
			var renderer = new THREE.WebGLRenderer( { alpha: true });
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setClearColor( 0x000000, 0 )
            renderer.setSize(  rendererWidth, rendererHeight );
			document.body.appendChild( renderer.domElement );


            // //设置模型1-绿色方块
			// var geometry = new THREE.BoxGeometry( 30, 30, 30 );
			// var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
			// var cube = new THREE.Mesh( geometry, material );
			// cube.position.set(0,-35,10);
			// //cube.matrixAutoUpdate = false;
			// //scene.add( cube );
			// cubeContainer.add(cube);
			// threejsContainerObj.add(cubeContainer);
            // // cube - end 



//Original obj , Mtl loader
		   //Obj + Mtl loading 

				// var onProgress = function ( xhr ) {
				// 	if ( xhr.lengthComputable ) {
				// 		var percentComplete = xhr.loaded / xhr.total * 100;
				// 		console.log( Math.round(percentComplete, 2) + '% downloaded' );
				// 	}
				// };
				// var onError = function ( xhr ) { };
				// //THREE.Loader.Handlers.add( /.dds$/i, new THREE.DDSLoader() );
				// var mtlLoader = new THREE.MTLLoader();
				// mtlLoader.setPath( './model/' );
				// mtlLoader.load( 'DuplexArcModel.mtl', function( materials ) {
				// 	materials.preload();
				// 	var objLoader = new THREE.OBJLoader();
				// 	objLoader.setMaterials( materials );
				// 	objLoader.setPath( './model/' );
				// 	objLoader.load( 'DuplexArcModel.obj', function ( object ) {
				// 		object.position.y = 0;
				// 		object.position.y = 0;
				// 		object.position.y = 0;
				// 		object.scale.x = 15;
				// 		object.scale.y = 15;
				// 		object.scale.z = 15;

				// 		objMtlContainer.add(object);
				//     	threejsContainerObj.add(objMtlContainer);

		
				// 	}, onProgress, onError );
				// });

				// Obj + Mtl - end
//Origin end


//Old loader start

		var loader = new THREE.OBJMTLLoader();
		loader.addEventListener('load', function(event){
			object = event.content;
			object.traverse(function(child){
				if (child instanceof THREE.mesh) {
					//The child is needed for the raycaster intersection later
					//By default, VisualCOBie does not have intersection
				};
			});
		});

		// BUDA BENIM MODEL YUKLEME DENEMEM
		
		        // DUPLEX APARTMENT ARCHITECTURAL MODEL
		        
		        loader.load("model/DuplexArcModel.obj", "model/DuplexArcModel.mtl", function (object) {

		            object.name = 'building';
		            //object.rotateOnAxis( new THREE.Vector3( 1, 0, 0 ), -90 * ( Math.PI/180 ) );
		            object.position.set ( -80, 140, 0 );
					object.scale.x = 20;
					object.scale.y = 20;
					object.scale.z = 20;

					duplexArcContainer.add(object);
				    threejsContainerObj.add(duplexArcContainer);


	
		        });
					
				// DUPLEX APARTMENT MEP MODEL

//Older loader end


            // 添加灯光
			//scene.add( new THREE.AmbientLight( 0x333333 ) ); //添加全局光

			var directionalLight = new THREE.DirectionalLight( 0xffeedd );//添加斜射光。类似太阳光（Unity里的）
			directionalLight.position.set( 0, 0, 1 );
			scene.add( directionalLight );

			scene.add( new THREE.AmbientLight( 0x888888 )); 

			var spotLight = new THREE.SpotLight(0x888888);
			spotLight.position.set(100, 140, 130);
			spotLight.intensity = 1; //调节灯光亮度。
			scene.add(spotLight);



			
            //定义hybridObj
            hybridObj = new HybridObject();
            hybridObj.setFullScreenOn();
            hybridObj.subscribeToMatrix();


			// only start animating the scene after the 3d model finishes loading
            function startAnimation() {
                // whenever we receive new matrices from the editor, update the 3d scene
                hybridObj.addMatrixListener(renderScene);
            }

            // utility function to set a three.js matrix using an array of elements
            function setMatrixFromArray(matrix, array) {
                matrix.set( array[0], array[4], array[8], array[12],
                            array[1], array[5], array[9], array[13],
                            array[2], array[6], array[10], array[14],
                            array[3], array[7], array[11], array[15]
                        );
            }


            function renderScene(modelViewMatrix, projectionMatrix) {
                // only set the projection matrix for the camera one time, since it stays the same
                if (!isProjectionMatrixSet) {
                    setMatrixFromArray(camera.projectionMatrix, projectionMatrix);
                    isProjectionMatrixSet = true;
                }

                if (isProjectionMatrixSet) {

                    // if you want to transform the children three.js objects, you could update their values here
                    // for example, setting scale to a value sent by a Hybrid Object
                    // turtleObj.scale.set(newTurtleScale, newTurtleScale, newTurtleScale);

                    // update model view matrix
                    setMatrixFromArray(threejsContainerObj.matrix, modelViewMatrix);

                    // 定义物体旋转。 Ipad中能看到旋转。
					// cube.rotation.x += 0.1;
				    // cube.rotation.y += 0.1;

					//objLoaderContainer.rotation.y += 0.05;



                    // update SEA3D Animations
                    //var delta = clock.getDelta();
                    //THREE.SEA3D.AnimationHandler.update( delta );
                    //THREE.AnimationHandler.update( delta );

                    // render the scene
                    renderer.render( scene, camera );
                }
            };

			startAnimation();//startAnimation()有回调函数为renderScene()
	 
		</script>






    <div id="quiz">
 
        <form>
        <fieldset style=" width:350px">

            <h id="title">CIV-1.1 Building Structure Quiz  </h><br><br>

            <label>Name:</label>
            <input type="text" id="Name">
            <br><br>

            <label>ID:</label>
            <input type="text" id="ID">
            <br><br>

            <label>1. Which material would you use for this building?</label><br>
            <input type="text" id="Material">
            <br><br>

            <label>2. What are the typical loading in this building?</label><br>
            <input type="text" id="Load">
            <br><br>


            <label>3. As a structural engineer, what would you consider when designing this kind of building?</label><br>
            <textarea id="Design" rows="8" cols="50">
            
            </textarea>
            


        </fieldset>
            <!-- <input type="submit"  value="Submit here" onclick="submit()"> 
            I dont know why the function can not be called in the <input button>. 
            However, the function can be called in the <button button> -->
        </form>

           
        <button id="button"> <span> <font color="white"> Submit </font> </span></button>

    </div>
 










	</body>
</html>